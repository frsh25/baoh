<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุชุญููู ุงููุดุงุนุฑ ุงูุนุฑุจูุฉ</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Bootstrap + Icons -->
  <link href="static/assets/vendor/bootstrap/css/bootstrap.css" rel="stylesheet" />
  <link href="static/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />

  <!-- CSS Files -->
  <link href="static/assets/css/main.css" rel="stylesheet" />
  <link href="static/assets/css/ana_csv.css" rel="stylesheet" />
  <link href="static/assets/css/templatemo-space-dynamic.css" rel="stylesheet" />
  <link href="static/assets/css/custom.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<!-- ุงูููุฏุฑ -->
<header id="header" class="header d-flex align-items-center sticky-top">
    
  <div class="container-fluid container-xl position-relative d-flex align-items-center">

    
    <a href="{{ url_for('home') }}" class="logo d-flex align-items-center ms-auto">
      <h1 class="sitename" style="text-align: right;">ุจูููุญ</h1>
     </a>

    <nav id="navmenu" class="navmenu">
      <ul>
        <li><a href="{{ url_for('home') }}">ุงูุฑุฆูุณูุฉ</a></li>
        <li><a href="#about">ูู ูุญู</a></li>
        <li><a href="#services">ุฎุฏูุงุชูุง</a></li>
        <li><a href="{{ url_for('index') }}">ุงูุชุญููู</a></li>
        <li><a href="#team">ูุฑูู ุงูุนูู</a></li>
        
            
      </ul>
    </nav>
    <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>

    <!-- ุฒุฑ ุจูุช ุงููุญุงุฏุซุฉ -->
<a class="btn-getstarted" href="{{ url_for('chat') }}">
ุจูุช ุงููุญุงุฏุซุฉ <i class="fas fa-robot"></i>
</a>

<!-- ุณูู ุงูุนูุฏุฉ ูููุฑุงุก -->
<a href="javascript:history.back()" class="btn-back">
<i class="bi bi-arrow-left-circle"></i>
</a>


  </div>
  
</header>

<section class="analyze-section py-5" style="direction: rtl; background-color: #f5f8fd;">
  <div class="container text-center">
    <h5 class="shine-text">ุญูู ุจูุงูุงุชู</h5>

    <form id="uploadForm" method="POST" enctype="multipart/form-data">
      <div class="upload-box border rounded p-4 mb-4 text-center" style="background-color: #ffffff; border: 2px dashed #7096D1;">
        <i class="fa-solid fa-cloud-arrow-up fa-3x mb-3 text-primary" style="color: #7096D1;"></i>
        <p class="mb-3 animated-text" style="color: #555;">ุงุณุญุจ ุงูููู ููุง ุฃู ุงุถุบุท ูุฑูุนู</p>

        <input type="file" id="csvFile" name="file" accept=".csv" class="form-control mb-3" style="max-width: 400px; margin: 0 auto;" required />

        <label for="selected_column" style="font-size: 16px; color: #555;">ุงุฎุชุฑ ุงูุนููุฏ ุงููุตู ูุชุญูููู:</label>
        <select name="selected_column" id="selected_column" class="form-control mb-3" style="max-width: 400px; margin: 0 auto;" required>
          <option value="">ุงุฎุชุฑ ุงูุนููุฏ</option>
        </select>

        <button type="submit" class="btn btn-primary" style="background-color: #7096D1; border: none; padding: 10px 30px;">
          ุชุญููู ุงูููู
        </button>
      </div>
    </form>

    {% if message %}
    <div id="message-box" class="alert alert-info" role="alert" style="max-width: 600px; margin: 0 auto;">
      {{ message }}
    </div>
    <script>
      setTimeout(() => document.getElementById('message-box').style.display = 'none', 4000);
    </script>
    {% endif %}

    <div id="notification" class="alert alert-info" role="alert" style="display: none; max-width: 600px; margin: 0 auto;">
      ุชู ุฑูุน ุงูููู ุจูุฌุงุญ! ุงุฎุชุฑ ุงูุนููุฏ ุงููุตู ููุชุญููู.
    </div>
  </div>
</section>

<script>
  document.getElementById('csvFile').addEventListener('change', async function () {
    const file = this.files[0];
    if (!file) return;

    document.getElementById('notification').style.display = 'block';

    const formData = new FormData();
    formData.append("file", file);

    try {
      const res = await fetch("/get_columns", { method: "POST", body: formData });
      const data = await res.json();

      const select = document.getElementById("selected_column");
      select.innerHTML = "<option value=''>ุงุฎุชุฑ ุงูุนููุฏ</option>";

      if (data?.columns?.length > 0) {
        data.columns.forEach(col => {
          const option = document.createElement("option");
          option.value = col;
          option.textContent = col;
          select.appendChild(option);
        });
      } else {
        alert("โ ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃุนูุฏุฉ ูุตูุฉ.");
      }
    } catch (error) {
      console.error("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุงูุฃุนูุฏุฉ:", error);
      alert("โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ูุนุงูุฌุฉ ุงูููู.");
    }

    setTimeout(() => document.getElementById('notification').style.display = 'none', 3000);
  });
</script>

<div class="container" id="summary-section">
  <div class="row justify-content-center text-center">
    <div class="col-md-4 mb-3">
      <div class="summary-box">
        <h5 class="summary-title">๐ ููุฎุต ุงูุจูุงูุงุช</h5>
        <p><strong>ุนุฏุฏ ุงูุตููู:</strong> <span id="numRows">{{ num_rows }}</span></p>
        <p><strong>ุนุฏุฏ ุงูุฃุนูุฏุฉ:</strong> <span id="numColumns">{{ num_columns }}</span></p>
        <p><strong>ุงููุฌููุน:</strong> <span id="total">{{ total }}</span></p>
        <p><strong>ุงููุชูุณุท:</strong> <span id="average">{{ average }}</span></p>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="summary-box">
        <h5 class="summary-title">๐ ุงูุฑุณู ุงูุจูุงูู ุงูุนููุฏู</h5>
        <canvas id="barChart"></canvas>
      </div>
    </div>
    
  </div>

  <div class="mt-4 d-flex justify-content-center gap-3 flex-wrap">
    <div class="dropdown custom-dropdown">
      <button class="btn dropdown-toggle" type="button" id="download-report" data-bs-toggle="dropdown" aria-expanded="false">
        ุชุญููู ุงูุชูุฑูุฑ
      </button>
      <ul class="dropdown-menu" aria-labelledby="reportDropdown"id="download-options">
        
        <li><a class="dropdown-item" id="download-pdf"  href="/download/pdf/{{ csv_id }}"> ๐ ุชุญููู ูู PDF</a></li>
        
        
      </ul>
    </div>
  </div>
</div>

<section class="steps">
  <h2>ููู ูุนููุ</h2>
  <div class="step"><strong>ุงูุฎุทูุฉ 1:</strong> ุงุฑูุน ุงูููู ุงููุฑุงุฏ ุชุญูููู</div>
  <div class="step"><strong>ุงูุฎุทูุฉ 2:</strong> ุงุถุบุท ุนูู "ุชุญููู ุงูููู"</div>
  <div class="step"><strong>ุงูุฎุทูุฉ 3:</strong> ุดุงูุฏ ุงููุชุงุฆุฌ ุงูุชูุตูููุฉ ููุจูุงูุงุช</div>
</section>

<section class="faq">
  <h2>ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ</h2>
  <div class="faq-item">
    <div class="faq-question">ูุง ูู ุฃููุงุน ุงููุดุงุนุฑ ุงูุชู ูุชู ุชุญููููุงุ</div>
    <div class="faq-answer">ูุชู ุชุตููู ุงููุดุงุนุฑ ุฅูู ุฅูุฌุงุจูุฉุ ุณูุจูุฉุ ููุญุงูุฏุฉ. ููููู ุฃูุถุงู ุนุฑุถ ูุดุงุนุฑ ุฏูููุฉ ูุซู ุงููุฑุญุ ุงูุญุฒูุ ุงูุบุถุจุ ุงูููุงุฌุฃุฉ ุญุณุจ ุงูุญุงุฌุฉ.</div>
  </div>
  <div class="faq-item">
    <div class="faq-question">ูู ูููู ุชุญููู ุงููููุงุช ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ</div>
    <div class="faq-answer">ุญุงููุงู ุชุฏุนู ุงูุฃุฏุงุฉ ุงููุบุฉ ุงูุนุฑุจูุฉ ููุท. ูุณูุชู ุฏุนู ุงููุบุงุช ุงูุฃุฎุฑู ูุฑูุจุงู ุจุฅุฐู ุงููู.</div>
  </div>
  <div class="faq-item">
    <div class="faq-question">ูู ูุชู ูุดุงุฑูุฉ ุงููููุงุช ุงูููุญููุฉุ</div>
    <div class="faq-answer">ูุงุ ูุญุชุฑู ุฎุตูุตูุชู ุชูุงูุงู. ูุง ูุชู ูุดุงุฑูุฉ ุฃู ูุญุชูู ูุชู ุฅุฏุฎุงูู.</div>
  </div>
  <div class="faq-item">
    <div class="faq-question">ูุง ูุฏู ุฏูุฉ ุงูุชุญูููุ</div>
    <div class="faq-answer">ุงูุชุญููู ูุชู ุจุงุณุชุฎุฏุงู ููุงุฐุฌ ูุฏุฑุจุฉ ุจุฏูุฉ ุนุงููุฉุ ููู ุชุจูู ุงููุชุงุฆุฌ ุชูุฑูุจูุฉ ุญุณุจ ุทุจูุนุฉ ุงููุต.</div>
  </div>
 
<!-- ุจุนุฏ ูุชุญ ุชุงุฌ <body> ูุจุงุดุฑุฉ -->
  <script>
    {% if csv_id %}
      window.csvId = "{{ csv_id }}";
    {% else %}
      window.csvId = null;
    {% endif %}
    {% if bar_chart_data %}
      window.barChartConfig = {{ bar_chart_data|tojson }};
      window.reportMeta = {
        numRows: {{ num_rows }},
        numColumns: {{ num_columns }},
        total: {{ total }},
        average: {{ average }}
      };
    {% endif %}
  </script>
  
  
 

 
<script src="{{ url_for('static', filename='assets/js/ana_csv.js') }}"></script>
<script src="static/assets/js/main.js"></script>

</body>
</html>
